---
import Layout from '@/layouts/Layout.astro';
import { experiences, education, skills, languages } from '../data/cv';
import CvTimeline from '@/components/ui/CvTimeline.astro';

import type { Experience, Education } from '../types/cv';
import List from '@/components/ui/List.astro';

let orderedExperiences: Experience[] = [];
let orderedEducations: Education[] = [];

const orderElement = <T extends { time: string }>(a: T, b: T) => {
  const presentValues = ['present', 'now', 'current', 'today', 'actuellement'];
  if (
    presentValues.includes(
      (a['time'] as string)?.split(' - ')[1]?.toLowerCase()
    ) ||
    presentValues.includes((a['time'] as string)?.toLowerCase())
  ) {
    // If the date is 'present' or 'actuellement', it should be the first element
    return -1;
  }
  const dateA = new Date((a['time'] as string)?.split(' - ')[1]);
  const dateB = new Date((b['time'] as string)?.split(' - ')[1]);
  return dateB.getTime() - dateA.getTime();
};

if (experiences.length > 0) {
  orderedExperiences = experiences.sort((a, b) => {
    return orderElement(a, b);
  });
}

if (education.length > 0) {
  orderedEducations = education.sort((a, b) => {
    return orderElement(a, b);
  });
}
---

<Layout title="CV | CreaSteph">
  {
    orderedEducations.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">Formation</h2>
        <CvTimeline elements={orderedEducations} colored={true} />
      </section>
    )
  }

  {
    orderedExperiences.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">
          Expérience professionnelle
        </h2>
        <CvTimeline elements={orderedExperiences} colored={true} />
      </section>
    )
  }

  {
    skills.length > 0 && (
      <section class="mb-12">
        <List listTitle="Compétences" listItems={skills} />
      </section>
    )
  }

  {
    languages.length > 0 && (
      <section class="mb-12">
        <h2 class="text-2xl font-bold mb-6 border-b pb-2">Langues</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          {languages.map((lang) => (
            <div class="card bg-base-200 p-4">
              <h3 class="font-semibold text-lg">{lang.name}</h3>
              <p class="text-base-content/70">{lang.level}</p>
            </div>
          ))}
        </div>
      </section>
    )
  }
</Layout>
